$luci-tooltip-tail-size: 10px !default;
$luci-tooltip-tail-edge-offset-horizontal: 10px !default;
$luci-tooltip-tail-edge-offset-vertical: 8px !default;
$luci-tooltip-offset: 4px !default;
$luci-tooltip-transition-timing: .4s !default;
$luci-tooltip-max-width: 220px !default;

@mixin luci-tooltip-hide() {
  opacity: 0;
  transition: opacity $luci-tooltip-transition-timing, visibility 0 $luci-tooltip-transition-timing;
  visibility: hidden;
}

@mixin luci-tooltip-show() {
  opacity: 1;
  transition: opacity $luci-tooltip-transition-timing, visibility 0 0;
  visibility: visible;
}

$luci-top-and-bottom-horizontal-alignments: (
  left: (
    main: (
      justify-content: flex-start,
      left: 0,
      right: auto
    ),
    tail: (
      left: $luci-tooltip-tail-edge-offset-horizontal,
      right: auto
    )
  ),
  center: (
    main: (
      justify-content: center,
      left: 50%,
      right: auto,
      translate-x: -50%
    ),
    tail: (
      left: 50%,
      right: auto,
      translate-x: -50%
    )
  ),
  right: (
    main: (
      justify-content: flex-end,
      left: auto,
      right: 0
    ),
    tail: (
      left: auto,
      right: $luci-tooltip-tail-edge-offset-horizontal
    )
  )
);

$luci-left-and-right-vertical-alignments: (
  top: (
    main: (
      bottom: 0,
      top: auto
    ),
    tail: (
      bottom: $luci-tooltip-tail-edge-offset-vertical,
      top: auto
    )
  ),
  center: (
    main: (
      bottom: auto,
      top: 50%,
      translate-y: -50%
    ),
    tail: (
      top: 50%,
      translate-y: -50%
    )
  ),
  bottom: (
    main: (
      bottom: auto,
      top: 0
    ),
    tail: (
      bottom: auto,
      top: $luci-tooltip-tail-edge-offset-vertical
    )
  )
);

$luci-tooltip-positions: (
  top: (
    position: (
      main: (
        bottom: 100%,
        top: auto,
      ),
      inner: (
        bottom: $luci-tooltip-tail-edge-offset-horizontal + ($luci-tooltip-tail-size / 2),
        top: auto
      ),
      tail: (
        bottom: auto,
        top: calc(100% - #{$luci-tooltip-tail-size / 2})
      )
    ),
    alignment: $luci-top-and-bottom-horizontal-alignments
  ),
  bottom: (
    position: (
      main: (
        bottom: auto,
        top: 100%,
      ),
      inner: (
        bottom: auto,
        top: $luci-tooltip-tail-edge-offset-horizontal + ($luci-tooltip-tail-size / 2)
      ),
      tail: (
        bottom: calc(100% - #{$luci-tooltip-tail-size / 2}),
        top: auto
      )
    ),
    alignment: $luci-top-and-bottom-horizontal-alignments
  ),
  left: (
    position: (
      main: (
        justify-content: flex-end,
        left: auto,
        right: 100%
      ),
      inner: (
        left: auto,
        right: $luci-tooltip-tail-edge-offset-vertical + $luci-tooltip-tail-size / 2,
        top: 0
      ),
      tail: (
        left: calc(100% - #{$luci-tooltip-tail-size / 2})
      )
    ),
    alignment: $luci-left-and-right-vertical-alignments
  ),
  right: (
    position: (
      main: (
        justify-content: flex-start,
        left: 100%,
        right: auto
      ),
      inner: (
        left: $luci-tooltip-tail-edge-offset-vertical + $luci-tooltip-tail-size / 2,
        right: auto,
        top: 0
      ),
      tail: (
        left: auto,
        right: calc(100% - #{$luci-tooltip-tail-size / 2})
      )
    ),
    alignment: $luci-left-and-right-vertical-alignments
  )
);

@mixin luci-tooltip-position($position: 'top', $alignment: 'center') {
  $position-data: map-get(map-get($luci-tooltip-positions, $position), 'position');
  $position-data-main: map-get($position-data, 'main');
  $position-data-inner: map-get($position-data, 'inner');
  $position-data-tail: map-get($position-data, 'tail');

  $alignment-data: map-get(map-get(map-get($luci-tooltip-positions, $position), 'alignment'), $alignment);
  $alignment-data-main: map-get($alignment-data, 'main');
  $alignment-data-tail: map-get($alignment-data, 'tail');

  $translate-x: 0;
  $translate-y: 0;
  $tail-translate-x: 0;
  $tail-translate-y: 0;


  .luci-tooltip__content {
    @each $property, $value in $position-data-main {
      #{$property}: $value;
    }
    @each $property, $value in $alignment-data-main {
      @if $property != 'translate-y' and $property != 'translate-x' {
        #{$property}: $value;
      }
    }

    @if(map-has-key($alignment-data-main, 'translate-x')) {
      $translate-x: map-get($alignment-data-main, 'translate-x');
    }

    @if(map-has-key($alignment-data-main, 'translate-y')) {
      $translate-y: map-get($alignment-data-main, 'translate-y');
    }

    transform: translate($translate-x, $translate-y);
  }

  .luci-tooltip__content-inner {
    @each $property, $value in $position-data-inner {
      #{$property}: $value;
    }

    &:after {
      @each $property, $value in $position-data-tail {
        #{$property}: $value;
      }
      @each $property, $value in $alignment-data-tail {
        #{$property}: $value;
      }

      @if(map-has-key($alignment-data-tail, 'translate-x')) {
        $tail-translate-x: map-get($alignment-data-tail, 'translate-x');
      }

      @if(map-has-key($alignment-data-tail, 'translate-y')) {
        $tail-translate-y: map-get($alignment-data-tail, 'translate-y');
      }

      transform: translate($tail-translate-x, $tail-translate-y) rotate(45deg);
    }
  }
}

.luci-tooltip {
  @include luci-tooltip-position('top', 'center');
  display: inline-block;
  position: relative;
  text-align: inherit;
  text-indent: 0;
}

.luci-tooltip__content {
  @include luci-box-sizing;
  @include luci-font-reset;
  @include luci-tooltip-hide;
  display: flex;
  max-width: $luci-tooltip-max-width;
  position: absolute;
  width: 100vw;
  z-index: $luci-z-index-molehill;

  // Show the tooltip when it's hovered, when it has a class of --visible or when it has a class of --hidden-on-hover AND --visible AND it's hovered
  // sass-lint:disable force-element-nesting - Linter is grumpy about this configuration
  .luci-tooltip--visible.luci-tooltip--hidden-on-hover:hover &,
  .luci-tooltip--visible &,
  .luci-tooltip:hover & {
    @include luci-tooltip-show;
  }
  // sass-lint:enable force-element-nesting

  // Disable default "show on hover" behavior for --show-on-click modifier class
  .luci-tooltip--hidden-on-hover:hover & {
    @include luci-tooltip-hide;
  }
}

.luci-tooltip__content-inner {
  background: $luci-background-color-purple;
  border-radius: $luci-border-radius-default;
  color: $luci-text-color-primary-on-dark;
  display: inline-block;
  font-size: $luci-font-size-md;
  padding: $luci-space-inset-md;
  position: relative;
  width: auto;

  &:after {
    background: $luci-background-color-purple;
    content: '';
    height: $luci-tooltip-tail-size;
    position: absolute;
    width: $luci-tooltip-tail-size;
    // z-index: -1;
  }
}

.luci-tooltip__text {
  @include luci-text-crop;
}

// Positioning Classes
.luci-tooltip--top-left {
  @include luci-tooltip-position('top', 'left');
}

.luci-tooltip--top-right {
  @include luci-tooltip-position('top', 'right');
}

.luci-tooltip--bottom-center {
  @include luci-tooltip-position('bottom', 'center');  
}

.luci-tooltip--bottom-left {
  @include luci-tooltip-position('bottom', 'left');
}

.luci-tooltip--bottom-right {
  @include luci-tooltip-position('bottom', 'right');
}

.luci-tooltip--left-center {
  @include luci-tooltip-position('left', 'center');
}

.luci-tooltip--left-top {
  @include luci-tooltip-position('left', 'top');
}

.luci-tooltip--left-bottom {
  @include luci-tooltip-position('left', 'bottom');
}

.luci-tooltip--right-center {
  @include luci-tooltip-position('right', 'center');
}

.luci-tooltip--right-top {
  @include luci-tooltip-position('right', 'top');
}

.luci-tooltip--right-bottom {
  @include luci-tooltip-position('right', 'bottom');
}
